{"path":"Papers/Papers files/Deep learning for improving the spatial resolution of magnetic particle imaging.pdf","text":"Physics in Medicine & Biology PAPER • OPEN ACCESS Deep learning for improving the spatial resolution of magnetic particle imaging To cite this article: Yaxin Shang et al 2022 Phys. Med. Biol. 67 125012 View the article online for updates and enhancements. You may also like Effect of depth of interaction resolution on the spatial resolution of SIAT aPET Zhonghua Kuang, Ling Zhang, Ning Ren et al. - Theoretical considerations on the spatial resolution limit of single-event particle radiography Lennart Volz, Charles-Antoine Collins- Fekete, Jarle R Sølie et al. - Study of PET intrinsic spatial resolution and contrast recovery improvement for PET/MRI systems Hao Peng and Craig S Levin - This content was downloaded from IP address 104.28.246.162 on 02/02/2024 at 18:43 Phys. Med. Biol. 67 (2022) 125012 https://doi.org/10.1088/1361-6560/ac6e24 PAPER Deep learning for improving the spatial resolution of magnetic particle imaging Yaxin Shang1,2,3, Jie Liu1,∗, Liwen Zhang2,3, Xiangjun Wu 4, Peng Zhang1, Lin Yin2,3, Hui Hui2,3,5,∗ and Jie Tian2,3,4,6,∗ 1 School of Computer and Information Technology, Beijing Jiaotong University, Beijing, 100069, People’s Republic of China 2 Beijing Key Laboratory of Molecular Imaging, Beijing, 100190, People’s Republic of China 3 CAS Key Laboratory of Molecular Imaging, Institute of Automation, Chinese Academy of Sciences, Beijing, 100190, People’s Republic of China 4 Beijing Advanced Innovation Center for Big Data-Based Precision Medicine, School of Engineering Medicine, Beihang University, Beijing, 100083, People’s Republic of China 5 University of Chinese Academy of Sciences, Beijing, 100080, People’s Republic of China 6 Zhuhai Precision Medical Center, Zhuhai People’s Hospital afﬁliated with Jinan University, Zhuhai, 519000, People’s Republic of China ∗ Authors to whom any correspondence should be addressed. E-mail: jieliu@bjtu.edu.cn, zhangliwen2018@ia.ac.cn, yinlin2016@ia.ac.cn, hui.hui@ia.ac.cn, tian@ieee.org, 20112039@bjtu.edu.cn, BY2110208@buaa.edu.cn and 18112039@bjtu.edu.cn Keywords: deep learning, magnetic particle imaging, spatial resolution, superparamagnetic iron oxide nanoparticles Supplementary material for this article is available online Abstract Objective. Magnetic particle imaging (MPI) is a new medical, non-destructive, imaging method for visualizing the spatial distribution of superparamagnetic iron oxide nanoparticles. In MPI, spatial resolution is an important indicator of efﬁciency; traditional techniques for improving the spatial resolution may result in higher costs, lower sensitivity, or reduced contrast. Approach. Therefore, we propose a deep-learning approach to improve the spatial resolution of MPI by fusing a dual-sampling convolutional neural network (FDS-MPI). An end-to-end model is established to generate high- spatial-resolution images from low-spatial-resolution images, avoiding the aforementioned short- comings. Main results. We evaluate the performance of the proposed FDS-MPI model through simulation and phantom experiments. The results demonstrate that the FDS-MPI model can improve the spatial resolution by a factor of two. Signiﬁcance. This signiﬁcant improvement in MPI could facilitate the preclinical application of medical imaging modalities in the future. 1. Introduction Magnetic particle imaging (MPI) is a functional tomography technique based on tracers that can directly detect the concentrated distribution of superparamagnetic iron oxide nanoparticles (SPIONs)(Gleich and Weizenecker 2005, Weizenecker et al 2007). MPI has high contrast, high sensitivity, and excellent depth penetration with no background tissue signal, enabling it to be a potential molecular imaging technique for biomedical applications (Weizenecker et al 2009, Ferguson et al 2012, Haegele et al 2012, Murase et al 2015, Khandhar et al 2017, Knopp et al 2017,Yu et al 2017, Talebloo et al 2020, Tong et al 2021). Current applications of MPI involve vascular imaging (Vaalma et al 2017, Kratz et al 2018), cancer detection (Yu et al 2017), cell tracking (Zheng et al 2015), and perfusion mapping (Sedlacik et al 2016). Spatial resolution is a key metric for evaluating the performance of MPI, which is primarily restricted through the performance of SPIONs and the hardware system. Previous studies have explored improving MPI resolution through different methods. Goodwill and Conolly (2010) showed that larger SPIO core sizes can improve MPI spatial resolution; however, the size expansions can lead to relaxation effects (Dhavalikar and Rinaldi 2014, York et al 2014, Zhao et al 2020, Tay et al 2021) developed superparamagnetic iron oxide nanoparticle chains to achieve an ideal stepped magnetization response and improve image resolution in MPI. OPEN ACCESS RECEIVED 28 November 2021 REVISED 17 March 2022 ACCEPTED FOR PUBLICATION 9 May 2022 PUBLISHED 10 June 2022 Original content from this work may be used under the terms of the Creative Commons Attribution 4.0 licence. Any further distribution of this work must maintain attribution to the author(s) and the title of the work, journal citation and DOI. © 2022 The Author(s). Published on behalf of Institute of Physics and Engineering in Medicine by IOP Publishing Ltd Several studies have been focused on adjusting drive parameters to mitigate relaxation losses and improve spatial resolution (Kuhlmann et al 2015, Weber et al 2015, Croft et al 2016). However, there is a concomitant decrease in the MPI tracer sensitivity. Tay et al (2019) proposed a pulsed MPI to overcome relaxation effects; however, the trade-off between the scan time/signal-to-noise ratio (SNR) and resolution efﬁciency is untenable. Bagheri and Hayden (2020) presented a novel MPI signal acquisition and conditioning protocol that achieved signiﬁcant breakthroughs in spatial resolution at the expense of image contrast. Overall, current techniques for reﬁning the spatial resolution limit either tracer sensitivity, SNR, or image contrast. Moreover, improving the spatial resolution via increasing the gradient strength may not be feasible owing to the high-power consumption. Recently, deep learning (DL) has yielded remarkable results in imaging applications (Noh et al 2015, Schmidhuber 2015,He et al 2016,Li et al 2018, Zhang et al 2018, El Naqa and Das 2020, Khan et al 2020) and has been proven efﬁcient in improving image quality (Ronneberger et al 2015, Chen et al 2021, Fang et al 2021, Sheng et al 2021, Yang et al 2021). Chen et al (2021) presented a convolutional neural network (CNN) to optimize low- dose computed tomography (CT) images. Tripathi and Bag (2020) designed a new CNN (CNN-DMRI) to denoise MRI scans. Van Sloun et al (2021) designed deep ultrasound localization microscopy to obtain super- resolution vascular images. You et al (2020) proposed a semi-supervised method to precisely obtain high- resolution (HR) CT images. In the context of MPI, Hayat et al (2021) used k-means++ algorithm for segmentation of MPI images and perform iron quantization analysis. Sun et al (2021) used machine learning algorithms to monitor islet organ transplants labeled with superparamagnetic iron oxide nanoparticles and provide quantitative information about their presence in vivo. Notably, several deep learning algorithms have been also reported to improve the performance of MPI. A CNN-based super-resolution technique was proposed in Aşkın et al (2021) to obtain the HR system matrix from the LR system matrix of MPI. Baltruschat et al (2020) used deep learning to restore the small-size system matrix to large-size system matrix, which saved the time of calibration of the system matrix. Dittmer et al (2020) used deep image prior for iterative image reconstruction, according to the quantitative metrics of peak signal-to-noise ratio (PSNR) and structural similarity metrics (SSIM), the method achieves better performance than variational and iterative regularization techniques. In this study, we developed a new fusion dual-sampling convolutional neural network (FDS-MPI) to overcome the low spatial resolution occasioned by hardware limitations and accomplish high-resolution reconstruction of MPI. To assess the performance of FDS-MPI, we ﬁrst used simulated LR and HR MPI datasets to train the FDS-MPI model. Then, we conducted experiments on the effect of noise on the resolution, which further demonstrated the robustness and superiority of the proposed model for MPI images. Furthermore, we tested the DL-based method on real MPI scans, resulting in favorable outcomes. 2. Methodology 2.1. Problem setting It was previously reported (York et al 2014, Khandhar et al 2017) that the MPI imaging equations are similar to the k-space theory of MRI, and the X-space theory was described mathematically in Goodwill and Conolly (2011), Goodwill et al (2012). Spatial resolution is a key metric for evaluating the MPI imaging performance, which can be characterized by the full width at half maximum (FWHM) of the point spread function. The FWHM equation is Tk M GdFWHM 24 ,1 sat B 0 13 () mp = -- where T is Kelvin temperature; 0m is the vacuum permeability; kB is Boltzmann’s constant; Msat is the saturation magnetization; G is the gradient strength, and d is the core size of the magnetic nanoparticles. This equation indicates that spatial resolution can be enhanced by improving G. Low-resolution and high-resolution MPI images are obtained by setting low gradient intensity and high gradient intensity respectively. Then, a high-resolution image (I HR) is derived from the low-resolution one (I LR). The problem can thus be expressed as fI Iarg min , 2 f LR HR 2 2() ( )- where f is regarded as a function of improving spatial resolution of the MPI image at a lower gradient strength and can be estimated using DL techniques. 2.2. Architecture of the proposed network Based on two subnetworks, we propose a fast and simple network. As described in ﬁgure 1, the network with fusion dual-sampling comprises two different networks: branches A and B, both of which incorporate a popular encoder-decoder structure. A feature encoder network (FEN), a feature decoder network (FDN), residual 2 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al learning (RL)(Drozdzal et al 2016,He et al 2016), rectiﬁed linear units (ReLUs), and a pooling layer (PL) were integrated into the designed network for model learning. Next, concatenate and convolutional layers were fused into dual-channel networks to improve performance. As shown in ﬁgure 1, branch A contains an auto-encoder architecture with a residual connection. Two PLs are added to extract representative information and simultaneously remove useless information; the MPI image has a large number of artefacts, and this system can remove unnecessary artefacts from the MPI image. In contrast to branch A, branch B has no PL. Consequently, useful information from the MPI image is not lost in branch B and can reconstruct high-resolution MPI images. The features extracted by the two branches are complementary in improving image resolution. The proposed network is detailed as follows. 2.2.1. Feature encoder network A chain was developed of fully connected convolutional layers as convolutional encoders. Adding a PL (Ronneberger et al 2015) can reduce the computational cost of the network. Nonetheless, useful information is typically lost. Therefore, considering the balance between efﬁciency and accuracy, branch A was chosen as a PL to remove artefacts from MPI images. In branch B, we avoided using a pooling layer because this may discard important structural details. 2.2.2. Feature decoder network Although the artefacts of MPI images are reduced after the convolutional layer, the convolution process may further diminish the structural details. Inspired by recent breakthroughs in biomedical imaging and semantic segmentation (Long et al 2015, Noh et al 2015, Ronneberger et al 2015, Drozdzal et al 2016), we included deconvolutional layers in the proposed network to recover structural details, which may be considered image reconstruction based on extracted features. We adopted fully deconvolutional layers to compose deconvolution decoders for image reconstruction. The convolutional and deconvolutional layers must have the same kernel size to ensure a match between the output and input of the proposed network. As shown in ﬁgure 1, this network framework has symmetry of paired convolutional and deconvolutional layers. 2.2.3. Residual learning RL can make the network train quickly and effectively. In He et al (2016), the training and testing accuracy of the residual model was signiﬁcantly improved. Accordingly, we introduced an RL method into the proposed network. RL is used in both branches (A and B). A skip-connection is incorporated in the proposed model to utilize RL. The contribution of the aforedescribed FDS-MPI is three-fold: (1) It increases width rather than depth via two subnetworks to improve the resolution of the MPI images; (2) It applies RL to prevent the gradient from disappearing or exploding; and (3) It utilizes a PL to balance performance and computational cost. Figure 1. Main framework of our DL method. 3 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al 2.3. Loss function The mean square error (MSE) was taken as the loss function for the FDS-MPI model. Given X is a high-gradient- strength MPI image, and Y is its lower equivalent, MSE can be obtained: MN Xi j Y i jMSE 1 ,, , 3 i M j N 11 2 2() ( ( )) ( )åå= ´ -F == where F represents a trained model or parameters, through which an estimated high-resolution MPI image Xˆ can be derived. The sizes of X and Y were M N.´ 2.4. Evaluation metrics For a quantitative assessment, we used three metrics: root mean square error (RMSE), peak signal-to-noise ratio (PSNR), and structural similarity index measure (SSIM). RMSE is usually used for evaluating the quality of predicted images. PSNR and SSIM are commonly used for image enhancement or improving the ﬁdelity of the image. RMSE is estimated as m XXRMSE 1 ,4i m ii1 2() ( )= å -=  where Xi and Xi are the means of the real and estimated high-resolution MPI images, respectively, and m represents the number of images. PSNR is estimated as MAX MSE PSNR 10 log , 510 2 ⎜⎟⎛ ⎝ ⎞ ⎠ ()= where MSE denotes the mean square error between the real and estimated high-resolution MPI images. SSIM is estimated as tt tt SSIM 22 ,6 XX XX XX X X 12 22 1 2 2 2 ()( ) ()( ) () ˆ ˆ ˆ ˆ mm s mm s s = ++ ++ + + where Xm and Xˆm are the means of the real and estimated high-resolution MPI images, respectively; t1 and t2 are constants; X 2s and X 2 ˆs represent the variances, and XXˆs is the covariance between X and X.ˆ 3. Experiments and results The performance of the proposed DL-based method is evaluated using simulated and real MPI scans, and the dataset, network training, and experimental results are discussed. 3.1. Dataset 3.1.1. Simulated data In this study 10 000 images from the Mixed National Institute of Standards and Technology database (MNIST) dataset were selected and resized to 100 100´ pixels as simulated phantoms for MPI. To simulate the magnetization of magnetic nanoparticles in response to an excited magnetic ﬁeld in MPI, we adopted the Langevin equation, as follows: Mr t M r mB r t kT kT mB r t ,coth , , ,7 B B 0 ⎜⎟⎡ ⎣ ⎢ ⎛ ⎝ ⎞ ⎠ ⎤ ⎦ ⎥ () ( ) ∣( )∣ ∣( )∣ ()=´ - where Br t,() is the total magnetic ﬁeld at position r and time t; m is the magnetic moment; and M r Nr m V0() () = D is the saturation magnetization of the particles contained in the volume V ;D N r() is the number of particles each contributing a magnetic moment m DM .sat 1 6 3p= We used MATLAB toolbox to program the X-space reconstruction method (Shen et al 2022) as previously described in Goodwill and Conolly (2010, 2011) to generate simulated MPI images. The scan parameters in simulating MPI images were consistent with the conﬁgurations of a preclinical MPI scanner (MOMENTUM, Magnetic Insight, Alameda, CA, USA). All the parameters for the MPI simulation are listed in table 1. To prove the robustness of the proposed method, different levels of white Gaussian noise were applied to the simulated MPI images. Of these simulated MPI images, 8000 were used for training and 2000 for testing. In addition, a two-tube phantom with different distances was used to evaluate the spatial resolution of the MPI image. Each tube had a diameter of 1 mm, and the gap between the two tubes was set to 0.6, 1, and 2 mm. 4 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al 3.1.2. Phantom data To validate the effectiveness of FDS-MPI, MPI images of three phantoms, including two tube phantoms with different distances and one resolution phantom as described in OpenMPIData (Knopp et al 2020), were chosen as the testing data. All the phantoms were ﬁlled with Perimag SPIONs (Micromod Partikeltechnologie GmbH, Rostock, Germany). The tube phantoms had a diameter of 2 mm, and the distances between the tubes were set to 1 and 2 mm. Imaging of the phantoms was performed using a commercial MPI scanner (MOMENTUM, Magnetic Insight Inc., Alameda, CA, USA). The low and high resolution MPI images were acquired by setting the scan modes as high sensitivity (G=3.0 T m−1) and high resolution (G=5.7 T m−1), respectively. 3.2. Training of the network We specially trained our network on simulated MPI images. During training, the patch size was 64 64´ with random cutting on datasets. In the experiments, the base learning rate started at 10−5 and was reduced by a factor of 0.5. The mini-batch size was set at 512. The number of epochs used to train the FDS-MPI models was 10 000. The convolution and deconvolution layers were initialized using a Gaussian kernel. The number of ﬁlters of the last layer was 1, whereas the number of ﬁlters of the other layers was set to 64. All kernels were 5×5 in size. The strides of convolution and deconvolution were 1 with 1 padding. In our work, the models were implemented in the open framework Pytorch with CUDA and CUDNN support. The model was run on a single NVIDIA Titan GPU. The network could process images of arbitrary sizes despite the training being performed in patches. 3.3. Experimental results 3.3.1. Simulated experimental results We compared the proposed FDS-MPI with several other networks to analyze its performance. CNN consists of only convolutional layers for medical image processing (Chen et al 2017b). In residual encoder-decoder CNN (REDCNN), there are convolutional layers, deconvolutional layers, and a skip connection (Chen et al 2017a). UCNN and REDUCNN become neural networks by adding pooling layers in CNN and REDCNN. The reconstructed MNIST images obtained using the different methods are displayed in ﬁgure 2(a). The MPI spatial resolution improved with increasing gradient strength. We also evaluated the impact of RL on MPI image resolution. As shown in ﬁgure 2(a), the spatial resolution obtained via RL (REDUCNN, REDCNN) is better than that without RL (UCNN and CNN). Furthermore, we evaluated the effectiveness of the FDS model against that of the single-network model. With regard to resolution improvement, we observed that FDS-MPI surpasses single networks (UCNN, CNN, REDUCNN, and REDCNN). A comparison of the FWHM results is listed in table 2. Additionally, we visualized the loss and PSNR values in the training processes of different networks. The curves of the training loss and PSNR of 100 epochs are shown in ﬁgure 3. The ﬁrst row displays PSNR values, whereas the second displays loss values. The ﬁrst column shows the results of UCNN and REDUCNN, and the second shows the results of CNN and REDCNN. The model with RL products has better PSNR and loss values and converges more rapidly. The results of the third column show that the FDS model produced better PSNR and loss values compared to the single-network models. These ﬁndings show that our method can sharpen the spatial resolution of MPI images. For a quantitative evaluation, the PSNR, SSIM, and RMSE of FDS-MPI were 28.11, 0.94, and 0.04, respectively, as listed in table 3. The results of all the evaluation metrics show that FDS-MPI can achieve the best performance compared with other single networks in improving the resolution of MPI images. In MPI, system noise is inevitable during the acquisition of signals. This can consequently reduce the SNR as well as the resolution of the MPI image. At this point, we conducted experiments on the effect of noise on the resolution to analyze the robustness of the proposed method. We used arbitrary noise to train the proposed network. The sample results at three different noise levels between 20 and 40 dB are shown in ﬁgure 4(a). Table 1. Parameters for the MPI simulation. Symbol Parameters Value Unit 0m Permeability of vacuum 410 7p´ - NA 2- D Nanoparticle diameter 20 nm Ms Saturation magnetization 4.77 10 5´ - Am 1- m Magnetic moment 6.75 10 18´ - Am2 T Kelvin temperature 293.15 K KB Boltzmann constant 1.38 10 23´ - JK 1- G Gradient 3 low resolution mode or() 6 high resolution mode( ) T m 1- FOV Field of view 20 20´ mm 5 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al Different rows represent different noise levels. The ﬁrst, second, and third rows illustrate MPI images corrupted with 40, 30, and 20 dB noise levels, respectively. As shown in ﬁgure 4(a), artefacts can still be found in the results reconstructed by UCNN and REDUCNN. Consequently, CNN and REDCNN cannot retain the structural features of the MPI image. In contrast, better robustness is shown in the FDS-MPI. For quantitative evaluation, the results obtained using the different methods are listed in table 4. At a noise level of 40 dB, the PSNR of FDS-MPI reached 26.81, while the best PSNR of the other networks was 25.20. Additionally, the RMSE and SSIM were signiﬁcantly improved in FDS-MPI compared to other networks. At the 30 dB noise level, the PSNR of FDS-MPI reached 26.34, whereas the highest PSNR of the other networks was 25.12. The RMSE and SSIM were still signiﬁcantly improved in FDS-MPI compared to other networks. At the 20 dB noise level, FDS-MPI obtained the best metrics. Thus, our method can effectively handle noise affected MPI images. Table 5 lists the quantitative results of resolution evaluation metrics. To further evaluate the performance of the FDS-MPI approach with respect to spatial resolution improvement, we investigated the network via two tube phantoms. The reconstructed images obtained using the Figure 2. Simulated experimental results using different methods. (a) Different deep learning methods are used for enhancing the simulated low resolution MPI images (the ﬁrst column) to compare with the simulated high resolution MPI images (the last column). (b) Normalized signal intensity proﬁles are plotted from the red lines in (a) for the simulated phantom 1, (c) 2 and (d) 3. Table 2. FWHM of the simulated experimental results via different methods. FWHM (mm) Methods Simulated phantom 1 Simulated phantom 2 Simulated phantom 3 UCNN 4.0 5.0 4.4 CNN 3.8 5.0 4.2 REDUCNN 2.6 4.4 4.0 REDCNN 2.8 4.0 3.2 FDS-MPI 2.6 3.2 2.6 6 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al different methods are shown in ﬁgure 5(a). The signal-intensity curves of the different methods are shown in ﬁgures 5(b) and (c), facilitating a visual comparison of spatial resolution. The signal-intensity curves are the line scans (blue midpoint lines), as shown in ﬁgure 5(a). For tubes with a gap of 0.6 mm, the two tubes reconstructed by UCNN and CNN in ﬁgure 5(a) are obscure, and the corresponding intensity curves in ﬁgure 5(b) have no peaks. This may indicate that UCNN and CNN would yield vague results at two-tube gaps of 1 and 2 mm. Although REDUCNN and REDCNN present two tubes in ﬁgure 5(a) and equivalent peaks in ﬁgures 5(b)–(d), artefacts are still present in the reconstructed scans, and the red and light-blue intensity curves are not congruent with the black intensity curve. However, FDS-MPI can clearly distinguish the two-tube phantoms at different distances. Furthermore, our method’s intensity curve (pink curve) is more similar to the high-resolution intensity curve (black curve), indicating that the FDS-MPI method outperforms the other methods. 3.3.2. Phantom experimental results We applied FDS-MPI to a real MPI phantom to further evaluate its performance. Accordingly, we scanned two- tube phantoms under high-sensitivity and isotropic modes. As shown in ﬁgure 6(a), the two rows represent the two tubes with distances of 1 and 2 mm, respectively. The ﬁrst column is the color-image phantom taken during the scan of MPI data. The second column is the low-resolution image scanned by a high-sensitivity mode. The third to seventh columns represent the experimental results of UCNN, CNN, REDUCNN, REDCNN, and FDS- MPI, respectively. The eighth column shows the high-resolution image scanned in isotropic mode. In the high-sensitivity mode (the second column), the two tubes are blurred to a lump. In addition, ﬁgures 6(b) and (c) show the signal-intensity curves of the different methods. The signal-intensity curves correspond to the line scans (orange midpoint lines) in ﬁgure 6(a). The two tubes reconstructed at a 1 mm gap via other methods are indistinguishable. However, for the tubes with a gap of 2 mm, the reconstructed images (FDS-MPI) in ﬁgure 6(a) show two distinct phantom tubes and their respective peaks in the pink intensity curves in ﬁgures 6(b) and (c). Conversely, the reconstructed images of the other methods show only vague phantoms of the two tubes. The image reconstructed by our network resembles the real high resolution MPI image Table 3. Evaluation results for the simulated experimental data via different methods. Methods PSNR SSIM RMSE UCNN 23.9762±2.0114 0.8531±0.0308 0.0650±0.0159 CNN 25.4232±1.9907 0.8819±0.0194 0.0550±0.0133 REDUCNN 23.6605±1.6443 0.8608±0.0237 0.0668±0.0127 REDCNN 26.4208±2.1710 0.9226±0.0144 0.0493±0.0189 FDS-MPI 28.1090±2.3986 0.9430±0.0127 0.0409±0.0129 Figure 3. PSNR and loss curves of different training models. 7 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al (6T m−1 gradient). Likewise, the peak intensity curve of FDS-MPI is similar to the black intensity curve of the high-resolution image. To analyze a more complex phantom, we supplemented the experiments with a 3D phantom. The experimental phantom was designed based on the resolution phantom of OpenMPIData (Knopp et al 2020). Because MPI is a tomographic technique, we processed each 2D tomography image, and then, the processed 2D images were composed into a 3D MPI image. This simpliﬁes the computational cost and makes the network easy to train compared to processing 3D images directly. As shown in ﬁgure 7(a), we only show a 2D tomographic image. The ﬁrst column is the color-image phantom. The second column is the low-resolution image scanned by a high sensitivity mode. The third column represents the experimental results of FDS-MPI. The fourth column shows the high-resolution image scanned in isotropic mode. The image after FDS-MPI processing is Figure 4. Simulated experimental results via different methods. (a) MPI scans are corrupted with 40, 30 and 20 dB noise levels. Different deep learning methods are used for enhancing the simulated low resolution MPI images (the ﬁrst column) to compare with the simulated high resolution MPI images (the last column). (b) Normalized signal intensity proﬁles are plotted from the red lines in (a) for the corrupted MPI images with the noise level of 40 dB, (c) 30 dB and (d) 20 dB. Table 4. Evaluation results of simulated experimental results corrupted with different noise levels via different methods. Metrics Noise levels Methods PSNR SSIM RMSE 40 dB UCNN 23.7118  1.8503 0.8228  0.0281 0.0667  0.0144 CNN 24.3736  1.7801 0.8246  0.0324 0.0656  0.0188 REDUCNN 23.9864  2.3178 0.8393  0.0310 0.0617  0.0127 REDCNN 25.1996  1.9737 0.8891  0.0240 0.0564  0.0128 FDS-MPI 26.8062  1.7467 0.8899  0.0127 0.0466  0.0100 30 dB UCNN 23.6726  1.8432 0.8135  0.0380 0.0670  0.0144 CNN 24.4362  1.7847 0.8183  0.0180 0.0613  0.0127 REDUCNN 25.1181  1.9567 0.8248  0.0322 0.0569  0.0128 REDCNN 24.0027  2.3075 0.8404  0.0305 0.0654  0.0186 FDS-MPI 26.3443  1.5834 0.8805  0.0246 0.0490  0.0095 20 dB UCNN 23.5139  1.8132 0.6512  0.0690 0.0682  0.0144 CNN 24.4203  1.7855 0.6558  0.0344 0.0614  0.0128 REDUCNN 24.8097  1.8955 0.8388  0.0300 0.0588  0.0128 REDCNN 23.9863  2.3178 0.8246  0.0324 0.0656  0.0188 FDS-MPI 24.8704  1.1851 0.8499  0.0269 0.0576  0.0084 8 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al Figure 6. Dual tube phantom experimental results. (a) Two phantoms scanned by the MPI scanner are compared using different methods. (b) Normalized signal intensity proﬁles are plotted from the blue lines in (a) for a dual-tube phantom with gaps of 1 mm and (c) 2 mm. Figure 5. Simulated dual-tube experimental results for resolution enhancement via (a) UCNN, CNN, REDUCNN, REDCNN, and FDS-MPI. (b) Normalized signal intensity proﬁles are plotted from the blue lines in (a) for the two-tube simulated phantom with a gap of 0.6, (c) 1 mm, and (d) 2 mm. 9 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al closer to the high-resolution image, and the artefacts are effectively removed. Figure 7(b) shows the signal intensity curves of the image proﬁle (red lines) of ﬁgure 7(a).In ﬁgure 7(b), the pink intensity curve of FDS-MPI is similar to the black intensity curve of the high-resolution image. The 3D dynamic pictures are shown in video. This implies that the proposed method can improve the resolution of the 3D phantom image. In addition, we also designed the in vivo experiments. Mice were scanned in high sensitivity and isotropic modes. Figure 8(a) shows the colour-image. Figure 8(b) shows the low-resolution image. Figure 8(c) shows the experimental results of FDS-MPI. Figure 8(d) shows the high-resolution image. In the low-resolution mode in mice, the spleen is nearly obscured by the liver. The results showed that the shape of the mice spleen was clearly displayed after processing by FDS-MPI (see the red arrows in ﬁgure 8). Therefore, our method works effectively in vivo data as well. 4. Discussion The MPI imaging results are inﬂuenced by system performance, especially the spatial resolution. Hence, improving spatial resolution is crucial to precisely locating the distribution of tracer materials. To date, traditional methods of improving resolution stiﬂe other imaging factors, such as sensitivity, image contrast, and Figure 7. Experimental results of 2D tomography phantom of 3D image. (a) 2D tomographic image and the result processing by FDS- MPI; (b) signal intensity curves—extracted from the proﬁle (red line) in ﬁgure 7(a). Table 5. FWHM of simulated experimental results corrupted with different noise levels via different methods. FWHM (mm) Methods 40 dB 30 dB 20 dB UCNN 4.2 4.2 4.6 CNN 3.4 3.8 3.8 REDUCNN 4.0 4.0 3.2 REDCNN 4.2 4.4 3.8 FDS-MPI 2.6 2.6 2.8 10 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al SNR. Moreover, high-resolution MPI requires expensive high-end hardware, such as a high-gradient ﬁeld, hence the high-power dissipation (Graeser et al 2019). This study introduced a novel FDS-MPI method to resolve the spatial resolution problem caused by hardware limitations. The most crucial contribution of this research involves the deep-learning mechanism proposed to sharpen the spatial resolution. In this work, we performed simulations and phantom experiments to verify the performance of our proposed method. Based on the simulation, our method could effectively improve the spatial resolution of MPI images by doubling the theoretical resolution. Through a comparison against single- network techniques, FDS-MPI exhibited superior results; we combined RL with FDS when designing the network. Background noise is a problem with MPI. Many studies (Them et al 2015, Straub and Schulz 2018, Knopp et al 2021) focus on removing the background noise, and these methods have achieved good results. In our experiments, artiﬁcial noise was added to the simulated MPI images. We observed that our method improved the resolution and SNR of MPI images despite the addition of noise. In addition to the simulation, we applied our method to a real MPI system, where MPI phantoms were created using an MPI scanner (MOMENTUM, Magnetic Insightic Inc., Alameda, CA, USA), with Perimag magnetic nanoparticles used as tracer material. Using our method, high-quality images were reconstructed at a low gradient. To our knowledge, this research is the ﬁrst application of DL to reconstruct high-spatial-resolution MPI images from a low gradient. We believe that a deep-learning-based approach is promising. Because this method includes image post- processing, and the MPI reconstruction algorithm used in the simulation is based on X-space theory, this method is applicable to X-space MPI scanners. Theoretically, our method can also be applied to MPI scanners from Bruker by constructing the training data based on a system matrix reconstruction algorithm. However, speciﬁc experimental research was not conducted, and we will carry out research in this ﬁeld in the future. In addition, if the training data and training strategy is changed, we can attempt to use this method in other medical imaging modalities. However, the design of our network is aimed at MPI images. The combination of RL and FDS can effectively extract effective features of MPI and remove useless features, thus improving MPI resolution. The image features of other modalities are different from MPI data; thus, the network details may need to be modiﬁed to obtain dependable results. Despite its many advantages, our study had several limitations. First, we could not obtain large quantities of real MPI data. Consequently, real MPI data were not added to the training dataset. Further, there were some differences between MNIST data and real MPI data. In future work, to solve the problem, we will use the powerful features of transfer learning (Pan and Yang 2009, Weiss et al 2016). First, we trained the network on the simulation data. Then, the real measured data was scanned, and the network was trained based on the measured data; therefore, we did not need to collect a large amount of real measured data, and we could learn the real measured data features and provide more accurate results. Second, a SPION concentration simulation was not incorporated into the study, and as such, sensitivity could not be quantiﬁed; real MPI data were scanned using a Perimag tracer at high concentrations. Third, to achieve high efﬁcacy and reduce the complexity of the network, Figure 8. Experimental results of in vivo data. (a) The color image. (b) The low-resolution image scanned by a high sensitivity mode. (c) The experimental results of FDS-MPI. (d) The high-resolution image scanned in isotropic mode. 11 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al in this study, FDS-MPI was currently developed only for enhancing 2D images, which is a limitation for 3D images that are acquired using a tomographic technique, such as MPI. Nevertheless, we can alternatively process each 2D tomographic image using FDS-MPI to form a 3D MPI image. In future work, an advanced 3D deep learning network will be developed to address these limitations. In addition, the MPI-MRI hybrid system is promising (Vogel et al 2014, Franke et al 2016). In future work, we can extend the method to hybrid MRI-MPI methods. The advantages are that the SPIONs can be precisely localized, and a more accurate quantitative analysis can be achieved. 5. Conclusion We developed a DL-based simple and quick method, namely FDS-MPI, to improve the spatial resolution in MPI. We used simple networks to solve complex problems. The proposed network combines two different subnetworks to improve image resolution; high-resolution images can then be reconstructed even in an MPI system with a low gradient ﬁeld. The experimental results demonstrated that deep learning has great potential for image resolution improvement and structural preservation in the ﬁeld of MPI. To evaluate the indicators of the proposed approach, we conducted experiments using simulated data and phantoms. The FDS-MPI model can perform at a high spatial resolution and improve the imaging quality, enabling MPI to be a more powerful tool in the ﬁeld of molecular imaging. This study represents preliminary research of MPI in deep learning. This research can provide opportunities for the development of MPI to obtain higher spatial resolution images, rendering a broader prospect for MPI applications. Acknowledgments This work was supported in part by the National Key Research and Development Program of China under Grant 2017YFA0700401 the National Natural Science Foundation of China under Grant: 62027901, 81827808, 81527805, 81571836, 81671851, KKA309004533, 81227901; CAS Youth Innovation Promotion Association under Grant 2018167 and CAS Key Technology Talent Program; The Project of High-Level Talents Team Introduction in Zhuhai City (Zhuhai HLHPTP201703). The authors would like to acknowledge the instrumental and technical support of Multimodal Biomedical Imaging Experimental Platform, Institute of Automation, Chinese Academy of Sciences. Ethical statement All animal studies and procedures were performed according to a protocol approved by the Chinese PLA General Hospital Animal Care and Use Committee in accordance with the National Institutes of Health Guideline on the Care and Use of Laboratory Animals. ORCID iDs Hui Hui https://orcid.org/0000-0002-6732-4232 Jie Tian https://orcid.org/0000-0003-0498-0432 References Aşkın B, Güngör A, Soydan D A, Top C B and Cukur T 2021 A CNN based super-resolution technique for magnetic particle imaging system matrix 29th Signal Processing and Communications Applications Conf. (SIU) 1–4 Bagheri H and Hayden M E 2020 Resolution enhancement in magnetic particle imaging via phase-weighting J. Magn. Magn. Mater. 498 166021 Baltruschat I M, Szwargulski P, Griese F, Grosser M, Werner R and Knopp T 2020 3d-SMRnet: achieving a new quality of MPI system matrix recovery by deep learning Int. Conf. on Medical Image Computing and Computer-Assisted Intervention 74–82 Chen H, Zhang Y, Kalra M K, Lin F, Chen Y, Liao P, Zhou J and Wang G 2017a Low-dose CT with a residual encoder-decoder convolutional neural network IEEE Trans. Med. Imaging 36 2524–35 Chen H, Zhang Y, Zhang W, Liao P, Li K, Zhou J and Wang G 2017b Low-dose CT via convolutional neural network Biomed. Opt. Express 8 679–94 Chen M, Pu Y F and Bai Y C 2021 Low-dose CT image denoising using residual convolutional network with fractional TV loss Neurocomputing 452 510–20 Croft L R, Goodwill P W, Konkle J J, Arami H, Price D A, Li A X, Saritas E U and Conolly S M 2016 Low drive ﬁeld amplitude for improved image resolution in magnetic particle imaging Med. Phys. 43 424–35 Dhavalikar R and Rinaldi C 2014 On the effect of ﬁnite magnetic relaxation on the magnetic particle imaging performance of magnetic nanoparticles J. Appl. Phys. 115 074308 12 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al Dittmer S, Kluth T, Baguer D O and Maass P 2020 Int. Workshop on Machine Learning for Medical Image Reconstruction 12450, 113–22 Drozdzal M, Vorontsov E, Chartrand G, Kadoury S and Pal C 2016 The importance of skip connections in biomedical image segmentation Deep Learning and Data Labeling Med. Appl. 10008 179–87 El Naqa I and Das S 2020 The role of machine and deep learning in modern medical physics Med. Phys. 47 E125–6 Fang W, Wu D F, Kim K, Kalra M K, Singh R, Li L and Li Q Z 2021 Iterative material decomposition for spectral CT using self-supervised Noise2Noise prior Phys. Med. Biol. 66 155013 Ferguson R M, Khandhar A P and Krishnan K M 2012 Tracer design for magnetic particle imaging (invited) J. Appl. Phys. 111 7B318–B3185 Franke J, Heinen U, Lehr H, Weber A, Jaspard F, Ruhm W, Heidenreich M and Schulz V 2016 System characterization of a highly integrated preclinical hybrid MPI-MRI scanner IEEE Trans. Med. Imaging 35 1993–2004 Gleich B and Weizenecker J 2005 Tomographic imaging using the nonlinear response of magnetic particles Nature 435 1214–7 Goodwill P W and Conolly S M 2010 The X-space formulation of the magnetic particle imaging process: 1D signal, resolution, bandwidth, SNR, SAR, and magnetostimulation IEEE Trans. Med. Imaging 29 1851–9 Goodwill P W and Conolly S M 2011 Multidimensional x-space magnetic particle imaging IEEE Trans. Med. Imaging 30 1581–90 Goodwill P W, Lu K, Zheng B and Conolly S M 2012 An x-space magnetic particle imaging scanner Rev. Sci. Instrum. 83 033708 Graeser M et al 2019 Human-sized magnetic particle imaging for brain applications Nat. Commun. 10 1–9 Haegele J, Rahmer J, Gleich B, Borgert J, Wojtczyk H, Panagiotopoulos N, Buzug T M, Barkhausen J and Vogt F M 2012 Magnetic particle imaging: visualization of instruments for cardiovascular intervention Radiology 265 933–8 Hayat H, Sun A, Hayat H, Liu S, Talebloo N, Pinger C, Bishop J O, Gudi M, Dwan B F and Ma X 2021 Artiﬁcial intelligence analysis of magnetic particle imaging for islet transplantation in a mouse model Mol. Imaging Biol. 23 18–29 He K M, Zhang X Y, Ren S Q and Sun J 2016 Deep residual learning for image recognition 2016 IEEE Conf. on Computer Vision and Pattern Recognition (Cvpr) 770–8 Khan S, Huh J and Ye J C 2020 Adaptive and compressive beamforming using deep learning for medical ultrasound IEEE Trans. Med. Ultrasonic Ferr. 67 1558–72 Khandhar A, Keselman P, Kemp S, Ferguson R, Goodwill P, Conolly S and Krishnan K 2017 Evaluation of PEG-coated iron oxide nanoparticles as blood pool tracers for preclinical magnetic particle imaging Nanoscale 9 1299–306 Knopp T, Gdaniec N and Moddel M 2017 Magnetic particle imaging: from proof of principle to preclinical applications Phys. Med. Biol. 62 R124–78 Knopp T, Grosser M, Graeser M, Gerkmann T and Möddel M 2021 Efﬁcient joint estimation of tracer distribution and background signals in magnetic particle imaging using a dictionary approach IEEE Trans. Med. Imaging 40 3568–79 Knopp T, Szwargulski P, Griese F and Gräser M 2020 OpenMPIData: An initiative for freely accessible magnetic particle imaging data Data Brief 28 104971 Kratz H, Taupitz M, de Schellenberger A A, Kosch O, Eberbeck D, Wagner S, Trahms L, Hamm B and Schnorr J 2018 Novel magnetic multicore nanoparticles designed for MPI and other biomedical applications: from synthesis to ﬁrst in vivo studies PLoS One 13 e0190214 Kuhlmann C, Khandhar A P, Ferguson R M, Kemp S, Wawrzik T, Schilling M, Krishnan K M and Ludwig F 2015 Drive-ﬁeld frequency dependent mpi performance of single-core magnetite nanoparticle tracers IEEE Trans. Magn 51 1-4 Li X M, Chen H, Qi X J, Dou Q, Fu C W and Heng P A 2018 H-DenseUNet: hybrid densely connected UNet for liver and tumor segmentation from CT volumes IEEE Trans. Med. Imaging 37 2663–74 Long J, Shelhamer E and Darrell T 2015 Fully convolutional networks for semantic segmentation 2015 Ieee Conf. on Computer Vision and Pattern Recognition (Cvpr) 3431–40 Murase K, Aoki M, Banura N, Nishimoto K, Mimura A, Kuboyabu T and Yabata I 2015 Usefulness of magnetic particle imaging for predicting the therapeutic effect of magnetic hyperthermia Open J. Med. Imaging 5 85–99 Noh H, Hong S and Han B 2015 Learning deconvolution network for semantic segmentation 2015 Ieee International Conference on Computer Vision (Iccv) 1520–8 Pan S J and Yang Q 2009 A survey on transfer learning IEEE Trans. Knowl. Data Eng. 22 1345–59 Ronneberger O, Fischer P and Brox T 2015 U-Net: convolutional networks for biomedical image segmentation Med. Image Comput. Comput.-Assisted Intervention, Pt Iii 9351 234–41 Schmidhuber J 2015 Deep learning in neural networks: an overview Neural Netw. 61 85–117 Sedlacik J, Frolich A, Spallek J, Forkert N D, Faizy T D, Werner F, Knopp T, Krause D, Fiehler J and Buhk J H 2016 Magnetic particle imaging for high temporal resolution assessment of aneurysm hemodynamics PLoS One 11 e0160097 Shen Y, Hu C, Zhang P, Tian J and Hui H 2022 A novel software framework for magnetic particle imaging reconstruction Int. J. Imaging Syst. Tech. 1–14 accepted Sheng R F, Zheng L Y, Jin K P, Sun W, Liao S, Zeng M S and Dai Y M 2021 Single-breath-hold T2WI liver MRI with deep learning-based reconstruction: a clinical feasibility study in comparison to conventional multi-breath-hold T2WI liver MRI Magn. Reson. Imaging 81 75–81 Straub M and Schulz V 2018 Joint reconstruction of tracer distribution and background in magnetic particle imaging IEEE Trans. Med. Imaging 37 1192–203 Sun A, Hayat H, Liu S, Tull E, Bishop J O, Dwan B F, Gudi M, Talebloo N, Dizon J R and Li W 2021 3D in vivo magnetic particle imaging of human stem cell-derived islet organoid transplantation using a machine learning algorithm Front. Cell Developmental Biol. 9 704483 Talebloo N, Gudi M, Robertson N and Wang P 2020 Magnetic particle imaging: current applications in biomedical research J. Magn. Reson. Imaging 51 1659–68 Tay Z W, Hensley D, Ma J, Chandrasekharan P, Zheng B, Goodwill P and Conolly S 2019 Pulsed excitation in magnetic particle imaging IEEE Trans. Med. Imaging 38 2389–99 Tay Z W, Savliwala S, Hensley D W, Fung K B, Colson C, Fellows B D, Zhou X, Huynh Q, Lu Y and Zheng B 2021 Superferromagnetic nanoparticles enable order‐of‐magnitude resolution & sensitivity gain in magnetic particle imaging Small Methods 5 2100796 Them K, Kaul M G, Jung C, Hofmann M, Mummert T, Werner F and Knopp T 2015 Sensitivity enhancement in magnetic particle imaging by background subtraction IEEE Trans. Med. Imaging 35 893–900 Tong W, Hui H, Shang W T, Zhang Y Q, Tian F, Ma Q, Yang X, Tian J and Chen Y D 2021 Highly sensitive magnetic particle imaging of vulnerable atherosclerotic plaque with active myeloperoxidase-targeted nanoparticles Theranostics 11 506–21 Tripathi P C and Bag S 2020 CNN-DMRI: a convolutional neural network for denoising of magnetic resonance images Pattern Recognit. Lett. 135 57–63 Van Sloun R J G, Solomon O, Bruce M, Khaing Z Z, Wijkstra H, Eldar Y C and Mischi M 2021 Super-resolution ultrasound localization microscopy through deep learning IEEE Trans. Med. Imaging 40 829–39 13 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al Vaalma S, Rahmer J, Panagiotopoulos N, Duschka R L, Borgert J, Barkhausen J, Vogt F M and Haegele J 2017 Magnetic particle Imaging (MPI): experimental quantiﬁcation of vascular stenosis using stationary stenosis phantoms PLoS One 12 e0168902 Vogel P, Lother S, Rückert M A, Kullmann W H, Jakob P M, Fidler F and Behr V C 2014 MRI meets MPI: a bimodal MPI-MRI tomograph IEEE Trans. Med. Imaging 33 1954–9 Weber A, Weizenecker J, Rahmer J, Franke J, Heinen U and Buzug T 2015 Resolution improvement by decreasing the drive ﬁeld amplitude 2015 5th Int. Workshop on Magnetic Particle Imaging (Iwmpi) 1-1 Weiss K, Khoshgoftaar T M and Wang D 2016 A survey of transfer learning J. Big Data 3 1–40 Weizenecker J, Borgert J and Gleich B 2007 A simulation study on the resolution and sensitivity of magnetic particle imaging Phys. Med. Biol. 52 6363–74 Weizenecker J, Gleich B, Rahmer J, Dahnke H and Borgert J 2009 Three-dimensional real-time in vivo magnetic particle imaging Phys. Med. Biol. 54 L1–10 Yang D G, Karimi H R and Sun K K 2021 Residual wide-kernel deep convolutional auto-encoder for intelligent rotating machinery fault diagnosis with limited samples Neural Netw. 141 133–44 York J N, Albanese C, Rodriguez O, Lee Y C, Ackun-Farmmer M and Van Keuren E 2014 The effects of particle shape and size on T-2 relaxation in magnetic resonance imaging J. Biomed. Nanotechnol. 10 3392–6 You C Y et al 2020 CT super-resolution GAN constrained by the identical, residual, and cycle learning ensemble (GAN-CIRCLE) IEEE Trans. Med. Imaging 39 188–203 Yu E Y, Bishop M, Zheng B, Ferguson R M, Khandhar A P, Kemp S J, Krishnan K M, Goodwill P W and Conolly S M 2017 Magnetic particle imaging: a novel in vivo imaging platform for cancer detection Nano Lett. 17 1648–54 Zhang Y L, Tian Y P, Kong Y, Zhong B N and Fu Y 2018 Residual Dense Network for Image Super-Resolution 2018 Ieee/Cvf Conference on Computer Vision and Pattern Recognition (Cvpr) 2472–81 Zhao Z Y, Garraud N, Arnold D P and Rinaldi C 2020 Effects of particle diameter and magnetocrystalline anisotropy on magnetic relaxation and magnetic particle imaging performance of magnetic nanoparticles Phys. Med. Biol. 65 025014 Zheng B, Vazin T, Goodwill P W, Conway A, Verma A, Saritas E U, Schaffer D and Conolly S M 2015 Magnetic Particle Imaging tracks the long-term fate of in vivo neural cell implants with high image contrast Sci. Rep. 5 14055 14 Phys. Med. Biol. 67 (2022) 125012 Y Shang et al","libVersion":"0.3.1","langs":""}